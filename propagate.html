<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LLA5785-CONSOLE | Ads</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #999;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #eee;
    }
    .preview-frame {
      width: 100%;
      height: 300px;
      border: 1px solid #ccc;
      margin-top: 20px;
    }
    .actions {
      margin-top: 10px;
    }
    button {
      padding: 5px 10px;
      margin-right: 5px;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <h1>Ad Manager (LLA5785-CONSOLE)</h1>
  <table id="adsTable">
    <thead>
      <tr>
        <th>Title</th>
        <th>Type</th>
        <th>Image URL</th>
        <th>Target URL</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h3>Add New Ad</h3>
  <input type="text" id="newTitle" placeholder="Title">
  <input type="text" id="newType" placeholder="Type (banner/text/iframe)">
  <input type="text" id="newImage" placeholder="Image URL (or text)">
  <input type="text" id="newURL" placeholder="Target URL">
  <button onclick="addAd()">Add Ad</button>

  <h3>Live Preview</h3>
  <iframe id="adPreview" class="preview-frame"></iframe>

  <script>
      const firebaseConfig = {
      apiKey: "AIzaSyDZ-cKKMPsIChAZDiHwQv4LrfnmOZQJKls",
      authDomain: "lla5785.firebaseapp.com",
      projectId: "lla5785",
      storageBucket: "lla5785.appspot.com",
      messagingSenderId: "50911987407",
      appId: "1:50911987407:web:92c6d742b4dc355a42604a"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const adListRef = db.collection("ad_list");

    const tableBody = document.querySelector("#adsTable tbody");
    const adPreview = document.getElementById("adPreview");

    function loadAds() {
      tableBody.innerHTML = "";
      adListRef.get().then(snapshot => {
        snapshot.forEach(doc => {
          const ad = doc.data();
          const row = document.createElement("tr");

          row.innerHTML = `
            <td contenteditable onblur="updateAd('${doc.id}', 'title', this.innerText)">${ad.title || ''}</td>
            <td contenteditable onblur="updateAd('${doc.id}', 'type', this.innerText)">${ad.type || ''}</td>
            <td contenteditable onblur="updateAd('${doc.id}', 'image', this.innerText)">${ad.image || ''}</td>
            <td contenteditable onblur="updateAd('${doc.id}', 'url', this.innerText)">${ad.url || ''}</td>
            <td>
              <button onclick="previewAd('${ad.type}', \`${ad.image}\`, '${ad.url}')">Preview</button>
              <button onclick="deleteAd('${doc.id}')">Delete</button>
            </td>
          `;
          tableBody.appendChild(row);
        });
      });
    }

    function updateAd(id, field, value) {
      adListRef.doc(id).update({ [field]: value });
    }

    function addAd() {
      const newAd = {
        title: document.getElementById("newTitle").value,
        type: document.getElementById("newType").value,
        image: document.getElementById("newImage").value,
        url: document.getElementById("newURL").value,
        active: true
      };
      adListRef.add(newAd).then(loadAds);
    }

    function deleteAd(id) {
      if (confirm("Delete this ad?")) {
        adListRef.doc(id).delete().then(loadAds);
      }
    }

    function previewAd(type, content, link) {
      if (type === "banner") {
        adPreview.srcdoc = `<a href="${link}" target="_blank"><img src="${content}" style="max-width:100%;"></a>`;
      } else if (type === "text") {
        adPreview.srcdoc = `<a href="${link}" target="_blank" style="color:blue; text-decoration:underline;">${content}</a>`;
      } else if (type === "iframe") {
        adPreview.src = link;
      } else {
        adPreview.srcdoc = "Unsupported type";
      }
    }

    loadAds();
  </script>
</body>
</html>
