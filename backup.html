<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LLA5785 Console - Backup</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #fafafa;
    }
    button {
      padding: 10px 16px;
      font-size: 16px;
      background-color: #007acc;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #005fa3;
    }
    pre {
      background: #222;
      color: #0f0;
      padding: 15px;
      height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      margin-top: 20px;
      border-radius: 4px;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>

<h1>LLA5785 Console - Backup Firestore Collections</h1>
<button id="backupBtn">Backup Members & Ads</button>
<pre id="logConsole">Ready.</pre>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDu3OcghkHbtOH6DnCkoGZyD4qTHUdlA5M",
    authDomain: "lla5785.firebaseapp.com",
    projectId: "lla5785",
    storageBucket: "lla5785.appspot.com",
    messagingSenderId: "693326104186",
    appId: "1:693326104186:web:19058ba6f6201092024a5b"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const backupBtn = document.getElementById("backupBtn");
  const logConsole = document.getElementById("logConsole");

  function log(text) {
    logConsole.textContent += "\n" + text;
    logConsole.scrollTop = logConsole.scrollHeight;
  }

  async function backupCollection(collectionName) {
    log(`Backing up collection: ${collectionName}...`);
    const snapshot = await db.collection(collectionName).get();
    const data = [];
    snapshot.forEach(doc => {
      data.push({ id: doc.id, ...doc.data() });
    });
    log(`Fetched ${data.length} records from ${collectionName}.`);
    return data;
  }

  function downloadJSON(data, filename) {
    const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    setTimeout(() => {
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }, 100);
  }

  backupBtn.addEventListener("click", async () => {
    logConsole.textContent = "Starting backup...\n";
    const dateStr = new Date().toISOString().slice(0,10);

    try {
      const membersData = await backupCollection("members");
      downloadJSON(membersData, `LLA5785_Backup_members_${dateStr}.json`);

      const adsData = await backupCollection("ad_list");
      downloadJSON(adsData, `LLA5785_Backup_ad_list_${dateStr}.json`);

      log("Backup complete. Check your downloads folder.");
    } catch (err) {
      log("Backup error: " + err.message);
    }
  });
</script>

</body>
</html>
